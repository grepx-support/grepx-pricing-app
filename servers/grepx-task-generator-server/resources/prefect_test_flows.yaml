# Example Prefect Flows Configuration
# This file demonstrates how to define Prefect flows, tasks, deployments, and work pools

# Prefect Work Pools - Define worker pools for executing flows
prefect_work_pools:
  - name: default-process-pool
    description: Default process-based work pool for general tasks
    pool_type: process
    concurrency_limit: 10
    is_active: true

# Prefect Flows - Define flows (similar to Dagster assets)
prefect_flows:
  - name: test_simple_flow
    description: A simple test flow that executes basic tasks
    flow_type: test
    tags:
      - test
      - example
    is_active: true

  - name: stock_data_pipeline
    description: Flow for downloading and processing stock market data
    flow_type: data_pipeline
    tags:
      - stocks
      - data
      - pipeline
    is_active: true

# Prefect Tasks - Define tasks within flows (each task executes a Celery task)
prefect_tasks:
  - name: test_hello_world_task
    flow_name: test_simple_flow
    description: Task that prints hello world
    celery_task_name: test.hello_world
    task_kwargs: {}
    timeout_seconds: 60
    retry_config:
      max_retries: 3
      retry_delay_seconds: 5
    is_active: true

  - name: test_calculate_sum_task
    flow_name: test_simple_flow
    description: Task that calculates sum of two numbers
    celery_task_name: test.calculate_sum
    task_kwargs:
      a: 10
      b: 20
    depends_on:
      - test_hello_world_task
    timeout_seconds: 60
    retry_config:
      max_retries: 2
      retry_delay_seconds: 10
    is_active: true

  - name: download_stock_data_task
    flow_name: stock_data_pipeline
    description: Download historical stock data
    celery_task_name: data.download_historical
    task_kwargs:
      ticker: "AAPL"
      period: "1mo"
      interval: "1d"
    timeout_seconds: 300
    retry_config:
      max_retries: 3
      retry_delay_seconds: 30
    tags:
      - download
      - yahoo
    is_active: true

  - name: calculate_indicators_task
    flow_name: stock_data_pipeline
    description: Calculate technical indicators on downloaded data
    celery_task_name: indicators.calculate_rsi
    task_kwargs:
      ticker: "AAPL"
      period: 14
    depends_on:
      - download_stock_data_task
    timeout_seconds: 180
    retry_config:
      max_retries: 2
      retry_delay_seconds: 15
    tags:
      - indicators
      - rsi
    is_active: true

# Prefect Deployments - Define deployment schedules and configurations
prefect_deployments:
  - name: test_simple_flow_manual
    flow_name: test_simple_flow
    description: Manual deployment for testing
    work_pool_name: default-process-pool
    work_queue_name: default
    schedule_type: null  # null = manual trigger only
    tags:
      - manual
      - test
    is_active: true

  - name: test_simple_flow_scheduled
    flow_name: test_simple_flow
    description: Scheduled deployment that runs every 5 minutes
    work_pool_name: default-process-pool
    work_queue_name: default
    schedule_type: cron
    schedule_config:
      cron_string: "*/5 * * * *"  # Every 5 minutes
      timezone: "Asia/Kolkata"
    tags:
      - scheduled
      - test
    is_active: false  # Disabled by default

  - name: stock_data_pipeline_daily
    flow_name: stock_data_pipeline
    description: Daily stock data pipeline at market close
    work_pool_name: default-process-pool
    work_queue_name: default
    schedule_type: cron
    schedule_config:
      cron_string: "30 15 * * 1-5"  # 3:30 PM on weekdays
      timezone: "Asia/Kolkata"
    parameters:
      ticker: "AAPL"
    tags:
      - daily
      - production
    is_active: false  # Disabled by default

  - name: stock_data_pipeline_interval
    flow_name: stock_data_pipeline
    description: Stock data pipeline with interval schedule
    work_pool_name: default-process-pool
    work_queue_name: default
    schedule_type: interval
    schedule_config:
      interval_seconds: 3600  # Every hour
      anchor_date: "2024-01-01T00:00:00"
      timezone: "Asia/Kolkata"
    parameters:
      ticker: "AAPL"
    tags:
      - interval
      - hourly
    is_active: false  # Disabled by default
