# Prefect Demo Flow Configuration
# This demonstrates a complete Prefect workflow with multiple tasks and dependencies

# Celery Tasks - Define the task implementations that will be executed
celery_tasks:
  - name: prefect.start
    module_path: business-tasks.tasks.test_prefect
    function_name: prefect_task_start
    description: Initialize Prefect workflow
    tags:
      - prefect
      - test
      - start
    timeout: 60
    is_active: true

  - name: prefect.process_data
    module_path: business-tasks.tasks.test_prefect
    function_name: prefect_task_process_data
    description: Process data in the workflow
    tags:
      - prefect
      - test
      - processing
    timeout: 120
    is_active: true

  - name: prefect.validate
    module_path: business-tasks.tasks.test_prefect
    function_name: prefect_task_validate
    description: Validate workflow data
    tags:
      - prefect
      - test
      - validation
    timeout: 60
    is_active: true

  - name: prefect.finalize
    module_path: business-tasks.tasks.test_prefect
    function_name: prefect_task_finalize
    description: Finalize workflow and aggregate results
    tags:
      - prefect
      - test
      - finalize
    timeout: 60
    is_active: true

# Prefect Work Pool
prefect_work_pools:
  - name: demo-process-pool
    description: Demo work pool for test flows
    pool_type: process
    concurrency_limit: 5
    is_active: true

# Prefect Flow
prefect_flows:
  - name: prefect_demo_flow
    description: Demo flow showing Prefect workflow orchestration with multiple tasks and dependencies
    flow_type: demo
    tags:
      - demo
      - test
      - workflow
    is_active: true

# Prefect Tasks - Define tasks within the flow
prefect_tasks:
  # Task 1: Start task (no dependencies)
  - name: start_workflow
    flow_name: prefect_demo_flow
    description: Initialize the workflow
    celery_task_name: prefect.start
    task_kwargs:
      flow_name: "prefect_demo_flow"
    timeout_seconds: 60
    retry_config:
      max_retries: 2
      retry_delay_seconds: 5
    tags:
      - initialization
    is_active: true

  # Task 2: Process data (depends on start)
  - name: process_workflow_data
    flow_name: prefect_demo_flow
    description: Process data from initialization
    celery_task_name: prefect.process_data
    task_kwargs:
      input_data: [10, 20, 30, 40, 50]
    depends_on:
      - start_workflow
    timeout_seconds: 120
    retry_config:
      max_retries: 3
      retry_delay_seconds: 10
    tags:
      - processing
    is_active: true

  # Task 3: Validate (depends on start, runs in parallel with process)
  - name: validate_workflow
    flow_name: prefect_demo_flow
    description: Validate workflow parameters
    celery_task_name: prefect.validate
    task_kwargs:
      threshold: 100
    depends_on:
      - start_workflow
    timeout_seconds: 60
    retry_config:
      max_retries: 2
      retry_delay_seconds: 5
    tags:
      - validation
    is_active: true

  # Task 4: Finalize (depends on both process and validate)
  - name: finalize_workflow
    flow_name: prefect_demo_flow
    description: Finalize workflow and aggregate results
    celery_task_name: prefect.finalize
    task_kwargs:
      summary_data:
        workflow: "prefect_demo_flow"
        tasks_count: 4
    depends_on:
      - process_workflow_data
      - validate_workflow
    timeout_seconds: 60
    retry_config:
      max_retries: 1
      retry_delay_seconds: 5
    tags:
      - finalization
    is_active: true

# Prefect Deployment
prefect_deployments:
  - name: prefect_demo_flow_manual
    flow_name: prefect_demo_flow
    description: Manual deployment for demo flow (trigger manually via UI or CLI)
    work_pool_name: demo-process-pool
    work_queue_name: default
    schedule_type: null  # Manual trigger only
    parameters:
      environment: "development"
      debug: true
    tags:
      - manual
      - demo
    is_active: true
